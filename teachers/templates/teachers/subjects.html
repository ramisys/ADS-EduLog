{% extends "base.html" %}
{% block title %}Teacher Subjects | EduLog{% endblock %}
{% block content %}
<div class="dashboard-container container py-4">

    <!-- Header -->
    <div class="mb-4 d-flex justify-content-between align-items-center">
      <div>
        <h2 class="text-primary">My Subjects</h2>
        <p class="text-muted small">View and manage your teaching subjects</p>
      </div>
      <div>
        <a href="{% url 'teachers:assign_subject' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle me-2"></i>Add Subject
        </a>
      </div>
    </div>

    <!-- Quick Stats Summary -->
    <div class="row g-4 mb-4">
      <!-- Total Subjects -->
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border rounded-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <p class="text-muted small mb-1">Total Subjects</p>
              <h5 class="text-primary mb-2">{{ total_subjects }}</h5>
              <span class="badge bg-primary-subtle text-primary">Active</span>
            </div>
            <div class="bg-primary-subtle p-3 rounded">
              <i class="bi bi-book-fill text-primary fs-4"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Students -->
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border rounded-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <p class="text-muted small mb-1">Total Students</p>
              <h5 class="text-primary mb-2">{{ total_students }}</h5>
              <span class="badge bg-success-subtle text-success">Across all subjects</span>
            </div>
            <div class="bg-success-subtle p-3 rounded">
              <i class="bi bi-people-fill text-success fs-4"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Sections -->
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border rounded-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <p class="text-muted small mb-1">Sections</p>
              <h5 class="text-primary mb-2">{{ total_sections }}</h5>
              <span class="badge bg-info-subtle text-info">Unique sections</span>
            </div>
            <div class="bg-info-subtle p-3 rounded">
              <i class="bi bi-collection-fill text-info fs-4"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Avg Students per Subject -->
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border rounded-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <p class="text-muted small mb-1">Avg Students</p>
              <h5 class="text-primary mb-2">{{ avg_students_per_subject }}</h5>
              <span class="badge bg-warning-subtle text-warning">Per subject</span>
            </div>
            <div class="bg-warning-subtle p-3 rounded">
              <i class="bi bi-graph-up-arrow text-warning fs-4"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- SUBJECT LIST -->
    {% if subjects %}
    <div class="row g-4">
      {% for item in subjects %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="card border rounded-3 p-3 h-100">
          
          <div class="d-flex align-items-center gap-3 mb-3">
            <div class="bg-primary p-3 rounded" style="min-width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
              <i class="bi bi-book text-white fs-5"></i>
            </div>
            <div class="flex-grow-1">
              <h5 class="text-primary mb-1">{{ item.subject.name }}</h5>
              <small class="text-muted">{{ item.subject.code }}</small>
            </div>
          </div>
  
          <div class="small mt-3 pt-3 border-top">
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Section</span>
              <span class="text-primary fw-semibold">{{ item.section.name }}</span>
            </div>
            
            <div class="d-flex justify-content-between mb-3">
              <span class="text-muted">Students Enrolled</span>
              <span class="text-primary fw-semibold">{{ item.student_count }}</span>
            </div>
            {% if item.student_count == 0 %}
            <div class="alert alert-info small mb-0 mt-2">
              <i class="bi bi-info-circle me-1"></i>No students enrolled yet. Students must be enrolled separately.
            </div>
            {% endif %}
          </div>

          <!-- Action Buttons -->
          <div class="mt-3 pt-3 border-top">
            <div class="d-grid gap-2">
              <a href="{% url 'teachers:attendance' %}?subject={{ item.subject.id }}" class="btn btn-primary btn-sm">
                <i class="bi bi-calendar-check me-2"></i>Take Attendance
              </a>
              <div class="btn-group" role="group">
                <a href="{% url 'teachers:students' %}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-people me-1"></i>Students
                </a>
                <a href="{% url 'teachers:grades' %}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-clipboard-data me-1"></i>Grades
                </a>
              </div>
              {% if item.assignment_id %}
              <form method="post" action="{% url 'teachers:remove_assignment' item.assignment_id %}" class="mt-2" onsubmit="return confirm('Are you sure you want to remove this subject assignment?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                  <i class="bi bi-trash me-1"></i>Remove Assignment
                </button>
              </form>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
      <div class="mb-3">
        <i class="bi bi-book text-muted" style="font-size: 3rem;"></i>
      </div>
      <h5 class="text-muted">No subjects assigned</h5>
      <p class="text-muted small mb-4">You don't have any subjects assigned yet. Click the "Add Subject" button above to assign a subject to a section.</p>
      <a href="{% url 'teachers:assign_subject' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i>Add Your First Subject
      </a>
    </div>
    {% endif %}
  </div>
  
{% endblock %}